---
layout: post
title: ! 'Symfony2 : Gérer un formulaire avec un ManyToMany'
categories:
- Labo
- Petits trucs pour...
- Vie Etudiante
tags:
- Doctrine2
- ManyToMany
- PFE
- Symfony2
status: publish
type: post
published: true
meta:
  _syntaxhighlighter_encoded: '1'
  brunelleschi_featured_post_width: 1/4 Width
  brunelleschi_featured_post_position: left
  _edit_last: '1'
  _social_aggregated_ids: a:2:{s:7:"twitter";a:1:{i:0;s:18:"171260427190284289";}s:8:"facebook";a:0:{}}
  _wp_old_slug: symfony2-gerer-un-formulaire-avec-un-manytomany-sans-attributs
  _social_notify: '1'
  _social_aggregation_log: a:34:{i:1329659725;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1329661819;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1329664863;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1329669929;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:0:"";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329677859;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329692904;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329722247;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329758199;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329760963;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329765918;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329770771;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329778418;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329795412;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329824922;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329832960;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329835132;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329838269;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329843424;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329852267;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329866919;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329896377;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1329940487;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1330026929;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1330199981;O:8:"stdClass":2:{s:6:"manual";s:0:"";s:5:"items";a:1:{s:7:"twitter";a:1:{i:0;O:8:"stdClass":4:{s:2:"id";s:18:"171260427190284289";s:4:"type";s:5:"reply";s:7:"ignored";s:1:"1";s:4:"data";a:1:{s:8:"username";s:7:"winzou_";}}}}}i:1347618315;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347620557;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347625599;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347631367;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347639726;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347655595;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347684785;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347728698;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347815457;O:8:"stdClass":1:{s:6:"manual";s:0:"";}i:1347988830;O:8:"stdClass":1:{s:6:"manual";s:0:"";}}
  _social_broadcasted_ids: a:1:{s:7:"twitter";a:1:{i:79756673;a:2:{s:18:"171226268493283328";a:3:{s:7:"message";s:2752:"eyJpZF9zdHIiOiIxNzEyMjYyNjg0OTMyODMzMjgiLCJjb29yZGluYXRlcyI6bnVsbCwiaW5fcmVwbHlfdG9fc3RhdHVzX2lkX3N0ciI6bnVsbCwicGxhY2UiOm51bGwsInBvc3NpYmx5X3NlbnNpdGl2ZSI6ZmFsc2UsImdlbyI6bnVsbCwiaW5fcmVwbHlfdG9fdXNlcl9pZF9zdHIiOm51bGwsImZhdm9yaXRlZCI6ZmFsc2UsImNyZWF0ZWRfYXQiOiJTdW4gRmViIDE5IDEzOjM0OjU4ICswMDAwIDIwMTIiLCJ1c2VyIjp7ImlkIjoiNzk3NTY2NzMiLCJwcm9maWxlX2JhY2tncm91bmRfaW1hZ2VfdXJsX2h0dHBzIjoiaHR0cHM6XC9cL3NpMC50d2ltZy5jb21cL2ltYWdlc1wvdGhlbWVzXC90aGVtZTNcL2JnLmdpZiIsImNyZWF0ZWRfYXQiOiJTdW4gT2N0IDA0IDE1OjM0OjQzICswMDAwIDIwMDkiLCJwcm9maWxlX2ltYWdlX3VybCI6Imh0dHA6XC9cL2ExLnR3aW1nLmNvbVwvcHJvZmlsZV9pbWFnZXNcLzEzOTk5MDc5OTNcLzI4MjRlZjc0NjI2OWIzNTA5MTI0MGVkNmU2NmUyMWE1X25vcm1hbC5qcGVnIiwicHJvZmlsZV90ZXh0X2NvbG9yIjoiNjM0MDQ3IiwidGltZV96b25lIjoiUGFyaXMiLCJmb2xsb3dpbmciOmZhbHNlLCJmb2xsb3dlcnNfY291bnQiOjI0MywicHJvZmlsZV9zaWRlYmFyX2JvcmRlcl9jb2xvciI6IkQzRDJDRiIsInNjcmVlbl9uYW1lIjoidGFsdXNfIiwidmVyaWZpZWQiOmZhbHNlLCJ1dGNfb2Zmc2V0IjozNjAwLCJkZWZhdWx0X3Byb2ZpbGVfaW1hZ2UiOmZhbHNlLCJsb2NhdGlvbiI6IlBhcmlzIiwibmFtZSI6IkJhcHRpc3RlIENsYXZpXHUwMGU5Iiwibm90aWZpY2F0aW9ucyI6ZmFsc2UsInByb2ZpbGVfYmFja2dyb3VuZF90aWxlIjpmYWxzZSwiZmF2b3VyaXRlc19jb3VudCI6MCwiaWRfc3RyIjoiNzk3NTY2NzMiLCJwcm9maWxlX3NpZGViYXJfZmlsbF9jb2xvciI6IkUzRTJERSIsImNvbnRyaWJ1dG9yc19lbmFibGVkIjpmYWxzZSwicHJvdGVjdGVkIjpmYWxzZSwic2hvd19hbGxfaW5saW5lX21lZGlhIjpmYWxzZSwicHJvZmlsZV9pbWFnZV91cmxfaHR0cHMiOiJodHRwczpcL1wvc2kwLnR3aW1nLmNvbVwvcHJvZmlsZV9pbWFnZXNcLzEzOTk5MDc5OTNcLzI4MjRlZjc0NjI2OWIzNTA5MTI0MGVkNmU2NmUyMWE1X25vcm1hbC5qcGVnIiwicHJvZmlsZV9iYWNrZ3JvdW5kX2NvbG9yIjoiRURFQ0U5IiwiZGVzY3JpcHRpb24iOiJGcmVuY2ggSVQgc3R1ZGVudCAoTWFzdGVyIGRlZ3JlZSksIHNwZWNpYWxpemVkIGluIFNvZnR3YXJlIEVuZ2luZWVyaW5nIGF0IEBFRlJFSV9vZmZpY2llbC4gU2VsZi1kZWNsYXJlZCBXZWIgRW50aHVzaWFzdCA6KSIsImRlZmF1bHRfcHJvZmlsZSI6ZmFsc2UsImxhbmciOiJlbiIsImlzX3RyYW5zbGF0b3IiOmZhbHNlLCJwcm9maWxlX2JhY2tncm91bmRfaW1hZ2VfdXJsIjoiaHR0cDpcL1wvYTEudHdpbWcuY29tXC9pbWFnZXNcL3RoZW1lc1wvdGhlbWUzXC9iZy5naWYiLCJzdGF0dXNlc19jb3VudCI6NDU1MCwiZ2VvX2VuYWJsZWQiOnRydWUsInByb2ZpbGVfbGlua19jb2xvciI6IjA4ODI1MyIsImZvbGxvd19yZXF1ZXN0X3NlbnQiOmZhbHNlLCJmcmllbmRzX2NvdW50IjozMzksImxpc3RlZF9jb3VudCI6MTYsInByb2ZpbGVfdXNlX2JhY2tncm91bmRfaW1hZ2UiOnRydWUsInVybCI6Imh0dHA6XC9cL2JhcHRpc3RlLmNsYXZpXHUwMGU5Lm5ldCJ9LCJpbl9yZXBseV90b19zY3JlZW5fbmFtZSI6bnVsbCwiaW5fcmVwbHlfdG9fdXNlcl9pZCI6bnVsbCwicmV0d2VldGVkIjpmYWxzZSwiaW5fcmVwbHlfdG9fc3RhdHVzX2lkIjpudWxsLCJjb250cmlidXRvcnMiOm51bGwsInRydW5jYXRlZCI6ZmFsc2UsInNvdXJjZSI6IjxhIGhyZWY9XCJodHRwczpcL1wvc29wcmVzdG8ubWFpbGNoaW1wLmNvbVwiIHJlbD1cIm5vZm9sbG93XCI+U29jaWFsIFByb3h5IGJ5IE1haWxjaGltcDxcL2E+IiwiaWQiOiIxNzEyMjYyNjg0OTMyODMzMjgiLCJyZXR3ZWV0X2NvdW50IjowLCJ0ZXh0IjoiTm91dmVsIGFydGljbGUgc3VyIG1vbiBibG9nIDogU3ltZm9ueTIgOiBHXHUwMGU5cmVyIHVuIGZvcm11bGFpcmUgYXZlYyB1biBNYW55VG9NYW55IC0gaHR0cDpcL1wvdC5jb1wvNTJRVEZTQWIifQ==";s:4:"urls";a:2:{i:0;s:116:"http://baptiste.xn--clavi-fsa.net/en-vrac/3615-mylife/vie-etudiante/symfony2-gerer-un-formulaire-avec-un-manytomany/";i:1;s:40:"http://baptiste.xn--clavi-fsa.net/?p=470";}s:7:"account";O:8:"stdClass":1:{s:4:"user";O:8:"stdClass":39:{s:12:"listed_count";s:2:"15";s:8:"verified";s:0:"";s:13:"notifications";s:0:"";s:9:"time_zone";s:5:"Paris";s:9:"protected";s:0:"";s:19:"follow_request_sent";s:0:"";s:28:"profile_sidebar_border_color";s:6:"D3D2CF";s:8:"location";s:5:"Paris";s:4:"name";s:16:"Baptiste
    Clavié";s:15:"default_profile";s:0:"";s:28:"profile_use_background_image";s:1:"1";s:10:"utc_offset";s:4:"3600";s:15:"followers_count";s:3:"228";s:3:"url";s:27:"http://baptiste.clavié.net";s:17:"profile_image_url";s:90:"http://a1.twimg.com/profile_images/1399907993/2824ef746269b35091240ed6e66e21a5_normal.jpeg";s:11:"description";s:122:"French
    IT student (Master degree), specialized in Software Engineering at @EFREI_officiel.
    Self-declared Web Enthusiast :)";s:6:"id_str";s:8:"79756673";s:21:"default_profile_image";s:0:"";s:14:"statuses_count";s:4:"4254";s:9:"following";s:0:"";s:13:"friends_count";s:3:"313";s:18:"profile_text_color";s:6:"634047";s:28:"profile_background_image_url";s:47:"http://a1.twimg.com/images/themes/theme3/bg.gif";s:6:"status";O:8:"stdClass":18:{s:5:"place";s:0:"";s:9:"favorited";s:0:"";s:13:"retweet_count";s:1:"0";s:23:"in_reply_to_screen_name";s:13:"cyprienlaleau";s:6:"id_str";s:18:"137689141386293248";s:9:"retweeted";s:0:"";s:25:"in_reply_to_status_id_str";s:18:"137688507551457280";s:3:"geo";s:0:"";s:11:"coordinates";s:0:"";s:19:"in_reply_to_user_id";s:9:"404311880";s:21:"in_reply_to_status_id";s:19:"1.3768850755146E+17";s:10:"created_at";s:30:"Sat
    Nov 19 00:30:24 +0000 2011";s:23:"in_reply_to_user_id_str";s:9:"404311880";s:6:"source";s:9:"TweetDeck";s:12:"contributors";s:0:"";s:9:"truncated";s:0:"";s:2:"id";s:19:"1.3768914138629E+17";s:4:"text";s:35:"@cyprienlaleau
    je t'ai répondu. :)";}s:13:"is_translator";s:0:"";s:18:"profile_link_color";s:6:"088253";s:20:"contributors_enabled";s:0:"";s:11:"geo_enabled";s:1:"1";s:34:"profile_background_image_url_https";s:49:"https://si0.twimg.com/images/themes/theme3/bg.gif";s:16:"favourites_count";s:1:"0";s:10:"created_at";s:30:"Sun
    Oct 04 15:34:43 +0000 2009";s:24:"profile_background_color";s:6:"EDECE9";s:11:"screen_name";s:6:"talus_";s:21:"show_all_inline_media";s:0:"";s:23:"profile_background_tile";s:0:"";s:2:"id";s:8:"79756673";s:4:"lang";s:2:"en";s:26:"profile_sidebar_fill_color";s:6:"E3E2DE";s:23:"profile_image_url_https";s:92:"https://si0.twimg.com/profile_images/1399907993/2824ef746269b35091240ed6e66e21a5_normal.jpeg";}}}s:18:"171226838272708609";a:3:{s:7:"message";s:2768:"eyJpZF9zdHIiOiIxNzEyMjY4MzgyNzI3MDg2MDkiLCJjb29yZGluYXRlcyI6bnVsbCwiaW5fcmVwbHlfdG9fc3RhdHVzX2lkX3N0ciI6bnVsbCwicGxhY2UiOm51bGwsInBvc3NpYmx5X3NlbnNpdGl2ZSI6ZmFsc2UsImdlbyI6bnVsbCwiaW5fcmVwbHlfdG9fdXNlcl9pZF9zdHIiOm51bGwsImZhdm9yaXRlZCI6ZmFsc2UsImNyZWF0ZWRfYXQiOiJTdW4gRmViIDE5IDEzOjM3OjE0ICswMDAwIDIwMTIiLCJ1c2VyIjp7ImlkIjoiNzk3NTY2NzMiLCJwcm9maWxlX2JhY2tncm91bmRfaW1hZ2VfdXJsX2h0dHBzIjoiaHR0cHM6XC9cL3NpMC50d2ltZy5jb21cL2ltYWdlc1wvdGhlbWVzXC90aGVtZTNcL2JnLmdpZiIsImNyZWF0ZWRfYXQiOiJTdW4gT2N0IDA0IDE1OjM0OjQzICswMDAwIDIwMDkiLCJwcm9maWxlX2ltYWdlX3VybCI6Imh0dHA6XC9cL2ExLnR3aW1nLmNvbVwvcHJvZmlsZV9pbWFnZXNcLzEzOTk5MDc5OTNcLzI4MjRlZjc0NjI2OWIzNTA5MTI0MGVkNmU2NmUyMWE1X25vcm1hbC5qcGVnIiwicHJvZmlsZV90ZXh0X2NvbG9yIjoiNjM0MDQ3IiwidGltZV96b25lIjoiUGFyaXMiLCJmb2xsb3dpbmciOmZhbHNlLCJmb2xsb3dlcnNfY291bnQiOjI0MywicHJvZmlsZV9zaWRlYmFyX2JvcmRlcl9jb2xvciI6IkQzRDJDRiIsInNjcmVlbl9uYW1lIjoidGFsdXNfIiwidmVyaWZpZWQiOmZhbHNlLCJ1dGNfb2Zmc2V0IjozNjAwLCJkZWZhdWx0X3Byb2ZpbGVfaW1hZ2UiOmZhbHNlLCJsb2NhdGlvbiI6IlBhcmlzIiwibmFtZSI6IkJhcHRpc3RlIENsYXZpXHUwMGU5Iiwibm90aWZpY2F0aW9ucyI6ZmFsc2UsInByb2ZpbGVfYmFja2dyb3VuZF90aWxlIjpmYWxzZSwiZmF2b3VyaXRlc19jb3VudCI6MCwiaWRfc3RyIjoiNzk3NTY2NzMiLCJwcm9maWxlX3NpZGViYXJfZmlsbF9jb2xvciI6IkUzRTJERSIsImNvbnRyaWJ1dG9yc19lbmFibGVkIjpmYWxzZSwicHJvdGVjdGVkIjpmYWxzZSwic2hvd19hbGxfaW5saW5lX21lZGlhIjpmYWxzZSwicHJvZmlsZV9pbWFnZV91cmxfaHR0cHMiOiJodHRwczpcL1wvc2kwLnR3aW1nLmNvbVwvcHJvZmlsZV9pbWFnZXNcLzEzOTk5MDc5OTNcLzI4MjRlZjc0NjI2OWIzNTA5MTI0MGVkNmU2NmUyMWE1X25vcm1hbC5qcGVnIiwicHJvZmlsZV9iYWNrZ3JvdW5kX2NvbG9yIjoiRURFQ0U5IiwiZGVzY3JpcHRpb24iOiJGcmVuY2ggSVQgc3R1ZGVudCAoTWFzdGVyIGRlZ3JlZSksIHNwZWNpYWxpemVkIGluIFNvZnR3YXJlIEVuZ2luZWVyaW5nIGF0IEBFRlJFSV9vZmZpY2llbC4gU2VsZi1kZWNsYXJlZCBXZWIgRW50aHVzaWFzdCA6KSIsImRlZmF1bHRfcHJvZmlsZSI6ZmFsc2UsImxhbmciOiJlbiIsImlzX3RyYW5zbGF0b3IiOmZhbHNlLCJwcm9maWxlX2JhY2tncm91bmRfaW1hZ2VfdXJsIjoiaHR0cDpcL1wvYTEudHdpbWcuY29tXC9pbWFnZXNcL3RoZW1lc1wvdGhlbWUzXC9iZy5naWYiLCJzdGF0dXNlc19jb3VudCI6NDU1MCwiZ2VvX2VuYWJsZWQiOnRydWUsInByb2ZpbGVfbGlua19jb2xvciI6IjA4ODI1MyIsImZvbGxvd19yZXF1ZXN0X3NlbnQiOmZhbHNlLCJmcmllbmRzX2NvdW50IjozMzksImxpc3RlZF9jb3VudCI6MTYsInByb2ZpbGVfdXNlX2JhY2tncm91bmRfaW1hZ2UiOnRydWUsInVybCI6Imh0dHA6XC9cL2JhcHRpc3RlLmNsYXZpXHUwMGU5Lm5ldCJ9LCJpbl9yZXBseV90b19zY3JlZW5fbmFtZSI6bnVsbCwiaW5fcmVwbHlfdG9fdXNlcl9pZCI6bnVsbCwicmV0d2VldGVkIjpmYWxzZSwiaW5fcmVwbHlfdG9fc3RhdHVzX2lkIjpudWxsLCJjb250cmlidXRvcnMiOm51bGwsInRydW5jYXRlZCI6ZmFsc2UsInNvdXJjZSI6IjxhIGhyZWY9XCJodHRwczpcL1wvc29wcmVzdG8ubWFpbGNoaW1wLmNvbVwiIHJlbD1cIm5vZm9sbG93XCI+U29jaWFsIFByb3h5IGJ5IE1haWxjaGltcDxcL2E+IiwiaWQiOiIxNzEyMjY4MzgyNzI3MDg2MDkiLCJyZXR3ZWV0X2NvdW50IjowLCJ0ZXh0IjoiTm91dmVsIGFydGljbGUgc3VyIG1vbiBibG9nIDogU3ltZm9ueTIgOiBHXHUwMGU5cmVyIHVuIGZvcm11bGFpcmUgYXZlYyB1biBNYW55VG9NYW55IC0gaHR0cDpcL1wvdC5jb1wvNTJRVEZTQWIgKGNjIEB3aW56b3VfKSJ9";s:4:"urls";a:2:{i:0;s:116:"http://baptiste.xn--clavi-fsa.net/en-vrac/3615-mylife/vie-etudiante/symfony2-gerer-un-formulaire-avec-un-manytomany/";i:1;s:40:"http://baptiste.xn--clavi-fsa.net/?p=470";}s:7:"account";O:8:"stdClass":1:{s:4:"user";O:8:"stdClass":39:{s:12:"listed_count";s:2:"15";s:8:"verified";s:0:"";s:13:"notifications";s:0:"";s:9:"time_zone";s:5:"Paris";s:9:"protected";s:0:"";s:19:"follow_request_sent";s:0:"";s:28:"profile_sidebar_border_color";s:6:"D3D2CF";s:8:"location";s:5:"Paris";s:4:"name";s:16:"Baptiste
    Clavié";s:15:"default_profile";s:0:"";s:28:"profile_use_background_image";s:1:"1";s:10:"utc_offset";s:4:"3600";s:15:"followers_count";s:3:"228";s:3:"url";s:27:"http://baptiste.clavié.net";s:17:"profile_image_url";s:90:"http://a1.twimg.com/profile_images/1399907993/2824ef746269b35091240ed6e66e21a5_normal.jpeg";s:11:"description";s:122:"French
    IT student (Master degree), specialized in Software Engineering at @EFREI_officiel.
    Self-declared Web Enthusiast :)";s:6:"id_str";s:8:"79756673";s:21:"default_profile_image";s:0:"";s:14:"statuses_count";s:4:"4254";s:9:"following";s:0:"";s:13:"friends_count";s:3:"313";s:18:"profile_text_color";s:6:"634047";s:28:"profile_background_image_url";s:47:"http://a1.twimg.com/images/themes/theme3/bg.gif";s:6:"status";O:8:"stdClass":18:{s:5:"place";s:0:"";s:9:"favorited";s:0:"";s:13:"retweet_count";s:1:"0";s:23:"in_reply_to_screen_name";s:13:"cyprienlaleau";s:6:"id_str";s:18:"137689141386293248";s:9:"retweeted";s:0:"";s:25:"in_reply_to_status_id_str";s:18:"137688507551457280";s:3:"geo";s:0:"";s:11:"coordinates";s:0:"";s:19:"in_reply_to_user_id";s:9:"404311880";s:21:"in_reply_to_status_id";s:19:"1.3768850755146E+17";s:10:"created_at";s:30:"Sat
    Nov 19 00:30:24 +0000 2011";s:23:"in_reply_to_user_id_str";s:9:"404311880";s:6:"source";s:9:"TweetDeck";s:12:"contributors";s:0:"";s:9:"truncated";s:0:"";s:2:"id";s:19:"1.3768914138629E+17";s:4:"text";s:35:"@cyprienlaleau
    je t'ai répondu. :)";}s:13:"is_translator";s:0:"";s:18:"profile_link_color";s:6:"088253";s:20:"contributors_enabled";s:0:"";s:11:"geo_enabled";s:1:"1";s:34:"profile_background_image_url_https";s:49:"https://si0.twimg.com/images/themes/theme3/bg.gif";s:16:"favourites_count";s:1:"0";s:10:"created_at";s:30:"Sun
    Oct 04 15:34:43 +0000 2009";s:24:"profile_background_color";s:6:"EDECE9";s:11:"screen_name";s:6:"talus_";s:21:"show_all_inline_media";s:0:"";s:23:"profile_background_tile";s:0:"";s:2:"id";s:8:"79756673";s:4:"lang";s:2:"en";s:26:"profile_sidebar_fill_color";s:6:"E3E2DE";s:23:"profile_image_url_https";s:92:"https://si0.twimg.com/profile_images/1399907993/2824ef746269b35091240ed6e66e21a5_normal.jpeg";}}}}}}
---
<p style="text-align: justify;">Hello,</p>
<p style="text-align: justify;">Je vais aborder ici un point qui n'est pas tellement... abordé dans la documentation de Symfony2, ou bien même celle de Doctrine2.</p>
<p style="text-align: justify;">Lors de mon projet de fin d'études (affectueusement nommé P.F.E), qui consistait à rédiger une sorte de tutoriel pour Sf2, j'ai été bloqué sur une relation ManyToMany. En éditant une entité, sur laquelle je souhaitais apposer un système de Tags. Sachant que ces tags n'ont pas réellement d'attributs, ce n'était donc pas une relation "OneToMany - ManyToOne" avec une entité tampon, mais bien une relation ManyToMany.</p>
<!--more-->
<p style="text-align: justify;">Je souhaitais donc pouvoir...</p>

<ul style="text-align: justify;">
	<li>Ajouter un couple de tags <strong>existant</strong> (donc, création d'une nouvelle <strong>relation</strong> entre <em>le tag et l'entité</em>)</li>
	<li>Ajouter un nouveau tag</li>
	<li>Supprimer une relation entre un tag et une entité</li>
</ul>
<p style="text-align: justify;">Donc OK, faire un traitement basique peut très bien convenir aux deux derniers points, à condition qu'on puisse se démerder pour avoir ce qu'on veut (à savoir un nouveau champ texte avec <code>property_path</code> à false dans le formulaire, un système pour gérer le front-end de l'ajout / suppression de tags, .. etc). En essayant de faire le keke (sinon c'est pas drôle ! ... Bien que ce soit casse-couilles), je me suis heurté à quelques problèmes que voici...</p>

<ul>
	<li style="text-align: justify;">Lors de l'ajout d'un nouveau tag, OK pas de problèmes, celui-ci est bien enregistré dans la BDD, et sa liaison est bien effectuée avec l'entité propriétaire. Donc OK, ça marche.</li>
	<li style="text-align: justify;">Lors de la suppression de la relation d'un tag... Il faut déjà sortir un système maison pour pas carrément <strong>supprimer le tag</strong>. Mais ça peut facilement s'éviter. Faire une liste de type <code>&lt;select&gt;</code> multiple peut être une solution.</li>
	<li style="text-align: justify;">Mais, lors de l'ajout d'un tag existant à la liste des tags déjà répertoriés (disons j'ai un tag A, B, C sur mon entité ; je souhaite lui ajouter le tag "D" et "A" par exemple), un bug assez gênant se posait : je me retrouvais ainsi avec un <strong>nouveau </strong>tag "A", un nouveau "D"... !</li>
</ul>
C'est à dire, dans ma base de données, j'avais alors...

[sourcecode]
// -- table des tags
1 - Tag A
2 - Tag B
3 - Tag C
4 - Tag D
5 - Tag D
6 - Tag A

// -- liaison avec une entité (disons l'entité 1) : idtag - identité
1 - 1
2 - 1
3 - 1
5 - 1
6 - 1
[/sourcecode]
<p style="text-align: justify;">Vous voyez le problème ? Ce n'est pas l'actuel objet tag sélectionné qui est créé, mais un nouveau ! Ce n'&amp;tait donc pas vraiment le comportement désiré, je pense que vous serez d'accords... Alors que je validais le tutoriel de winzou sur <a href="http://www.siteduzero.com/tutoriel-3-517569-symfony2-un-tutoriel-pour-debuter-avec-le-framework-symfony2.html">Symfony2</a>, j'en ai profité pour lui demander un peu conseil sur ce point là, puisque je m'occupais, en même temps, de la partie Doctrine2 de son tuto. Et, en cherchant un peu, nous avons trouvé la solution.</p>
<p style="text-align: justify;">Il fallait en fait manipuler la <code>Collection</code> renvoyée par le formulaire (une collection de <code>Tag</code>), et faire un filtre dessus. En effet, à chaque ajout, l'id était à <code>null</code>... Et comme le champ du tag n'était pas unique (s'il l'était, ça aurait alors posé problème), il se disait que c'en était un nouveau ! D'où la duplication. Une fois le problème identifié, il fallait faire, comme je le disais donc, faire un filtre sur le Repository des tags, pour filtrer la collection et remplacer les éléments si besoin.</p>

[sourcecode language="php"]
public function filter(Collection $tags) {
  // get the tag names that were added in the collection
  $names = array();
  $flatTags = array();

  foreach ($tags->toArray() as $k => $tag) {
    if (in_array($tag->getContent(), $flatTags)) {
      $tags->remove($k);
      continue;
    }

    $flatTags[] = $tag->getContent();

    if ($tag->getId() === null) {
      $names[$k] = $tag->getContent();
    }
  }

  // all tags already exist...
  if (!$names) {
    return;
  }

  $qb = $this->createQueryBuilder('t');
  $tagsInDB = $qb->where($qb->expr()->in('t.content', $names))
                 ->getQuery()
                 ->getResult();

  // -- Replacing the tags in the array...
  foreach ($tagsInDB as $tag) {
    $tags->remove(array_search($tag->getContent(), $names));
    $tags->add($tag);
  }
}
[/sourcecode]

<p style="text-align: justify;">Et, dans le traitement du formulaire, penser à appeler cette méthode avant de persister les tags :</p>

[sourcecode language="php"]
// ....
if ($form->isValid()) {
  $em = $this->getDoctrine()->getEntityManager();

  // -- filtering tags
  $this->getDoctrine()->getRepository('MyBundle:Tag')->filter($entity->getTags());

  foreach ($entity->getTags() as $tag) {
    $em->persist($tag);
  }

  // ...
  $em->persist($entity);
  $em->flush();
}

// ...
[/sourcecode]

<p style="text-align: justify;">Problem Solved ! :)</p>
